const ytdl=require('ytdl-core'),{YTSearcher}=require('ytsearcher'),ypi=require('youtube-playlist-info'),Discord=require('discord.js'),PACKAGE=require('./package.json');exports.start=(n,d)=>{var s=new class{constructor(t,o){this.commands=new Map,this.aliases=new Map,this.youtubeKey=o&&o.youtubeKey,this.botPrefix=o&&o.prefix||'!',this.embedColor=o&&o.embedColor||'GREEN',this.thumbnailType=o&&o.thumbnailType||'high',this.anyoneCanLeave=!!(o&&o.anyoneCanLeave||!1),this.global=o&&o.global||!1,this.maxQueueSize=parseInt(o&&o.maxQueueSize||100),this.defVolume=parseInt(o&&o.defVolume||50),this.anyoneCanSkip=!!(o&&o.anyoneCanSkip||!1),this.clearInvoker=!!(o&&o.clearInvoker||!1),this.helpCmd=o&&o.helpCmd||'musichelp',this.disableHelp=!!(o&&o.disableHelp||!1),this.helpHelp=o&&o.helpHelp||'Shows help for commands.',this.helpAlt=o&&o.helpAlt||[],this.playCmd=o&&o.playCmd||'play',this.disablePlay=!!(o&&o.disablePlay||!1),this.playHelp=o&&o.playHelp||'Queue a song/playlist by URL or search for a song.',this.playAlt=o&&o.playAlt||[],this.skipCmd=o&&o.skipCmd||'skip',this.disableSkip=!!(o&&o.disableSkip||!1),this.skipHelp=o&&o.skipHelp||'Skip a song or multi songs.',this.skipAlt=o&&o.skipAlt||[],this.joinCmd=o&&o.joinCmd||'join',this.disableJoin=!!(o&&o.disableJoin||!1),this.joinHelp=o&&o.joinHelp||'Join your current voice channel.',this.joinAlt=o&&o.joinAlt||[],this.queueCmd=o&&o.queueCmd||'queue',this.disableQueue=!!(o&&o.disableQueue||!1),this.queueHelp=o&&o.queueHelp||'Shows the current queue.',this.queueAlt=o&&o.queueAlt||[],this.pauseCmd=o&&o.pauseCmd||'pause',this.pauseHelp=o&&o.pauseHelp||'Pauses the queue.',this.disablePause=!!(o&&o.disablePause||!1),this.pauseAlt=o&&o.pauseAlt||[],this.resumeCmd=o&&o.resumeCmd||'resume',this.disableResume=!!(o&&o.disableResume||!1),this.resumeHelp=o&&o.resumeHelp||'Resume the queue.',this.resumeAlt=o&&o.resumeAlt||[],this.volumeCmd=o&&o.volumeCmd||'volume',this.disableVolume=!!(o&&o.disableVolume||!1),this.volumeHelp=o&&o.volumeHelp||'Adjusts the volume of the bot.',this.volumeAlt=o&&o.volumeAlt||[],this.leaveCmd=o&&o.leaveCmd||'leave',this.disableLeave=!!(o&&o.disableLeave||!1),this.leaveHelp=o&&o.leaveHelp||'Leave and clear the queue.',this.leaveAlt=o&&o.leaveAlt||[],this.clearCmd=o&&o.clearCmd||'clearqueue',this.disableClear=!!(o&&o.disableClear||!1),this.clearHelp=o&&o.clearHelp||'Clears the current queue.',this.clearAlt=o&&o.clearAlt||[],this.searchCmd=o&&o.searchCmd||'search',this.disableSearch=!!(o&&o.disableSearch||!1),this.searchHelp=o&&o.searchHelp||'Searchs for up to 10 results.',this.searchAlt=o&&o.searchAlt||[],this.loopCmd=o&&o.loopCmd||'loop',this.disableLoop=!!(o&&o.disableLoop||!1),this.loopHelp=o&&o.loopHelp||'Changes the loop state.',this.loopAlt=o&&o.loopAlt||[],this.setCmd=o&&o.setCmd||'set',this.disableSet=!!(o&&o.disableSet||!1),this.setHelp=o&&o.setHelp||'Changes settings for the server. Use without specifing a setting to see valid settings.',this.setAlt=o&&o.setAlt||[],this.ownerCmd=o&&o.ownerCmd||'owner',this.disableOwnerCmd=!!(o&&o.disableOwnerCmd||!1),this.ownerHelp=o&&o.ownerHelp||'Owner commands and functions.',this.ownerAlt=o&&o.ownerAlt||[],this.npCmd=o&&o.npCmd||'np',this.disableNp=!!(o&&o.disableNp||!1),this.npHelp=o&&o.npHelp||'Shows the currently playing song.',this.npAlt=o&&o.npAlt||[],this.enableQueueStat=!!(o&&o.enableQueueStat||!1),this.anyoneCanAdjust=!!(o&&o.anyoneCanAdjust||!1),this.ownerOverMember=!!(o&&o.ownerOverMember||!1),this.botOwner=o&&o.botOwner||null,this.logging=!!(o&&o.logging||!1),this.enableAliveMessage=!!(o&&o.enableAliveMessage||!1),this.aliveMessage=o&&o.aliveMessage||'',this.aliveMessageTime=parseInt(o&&o.aliveMessageTime||6e5),this.requesterName=!!(o&&o.requesterName||!1),this.inlineEmbeds=!!(o&&o.inlineEmbeds||!1),this.maxWait=parseInt(o&&o.maxWait||15000),this.anyoneCanPause=!!(o&&o.anyoneCanPause||!0),this.dateLocal=o&&o.dateLocal||'en-US',this.clearOnLeave=o&&o.clearOnLeave||!1,this.checkQueues=o&&o.checkQueues||!1,this.queues=new Map,this.botPrefixs=new Map,this.advancedMode=o&&o.advancedMode||{},this.botAdmins=o&&o.botAdmins||[]}logger(t,o,u){console.log(`[${t}] [${o.guild.name}] ${u}`)}}(n,d);exports.bot=s,s.advancedMode&&s.advancedMode.enabled&&(s.advancedMode={enabled:!!(d&&d.advancedMode.enabled||!1),multiPrefix:!!(d&&d.advancedMode.multiPrefix||!1),serverPrefixs:d&&d.advancedMode.serverPrefixs||{}});(async function(){8>process.version.slice(1).split('.')[0]&&(console.error(new Error(`[MusicBot] node 8 or higher is needed, please update`)),process.exit(1)),s.disableLeave&&s.disableSkip&&s.disablePlay&&s.disableQueue&&s.disableHelp&&s.disableResume&&s.disablePause&&s.disableLoop&&s.disableClear&&s.disableNp&&s.disableSearch&&s.disableVolume&&(console.error(new Error(`all commands disabled`)),process.exit(1)),'object'!=typeof s.embedColor&&'number'!=typeof s.embedColor&&'string'!=typeof s.embedColor&&(console.error(new TypeError(`embedColor must be an object (array), number, or a string`)),process.exit(1)),'object'!=typeof s.botAdmins&&(console.error(new TypeError(`botAdmins must be an object (array)`)),process.exit(1)),'boolean'!=typeof s.clearOnLeave&&(console.error(new TypeError(`clearOnLeave must be a boolean`)),process.exit(1)),'boolean'!=typeof s.checkQueues&&(console.error(new TypeError(`checkQueues must be a boolean`)),process.exit(1)),'string'!=typeof s.dateLocal&&(console.error(new TypeError(`dateLocal must be a string`)),process.exit(1)),'object'!=typeof s.advancedMode&&(console.error(new TypeError(`advancedMode must be an object`)),process.exit(1)),s.advancedMode.enabled&&'boolean'!=typeof s.advancedMode.enabled&&(console.error(new TypeError(`advancedMode.enabled must be a boolean`)),process.exit(1)),s.advancedMode.multiPrefix&&'boolean'!=typeof s.advancedMode.multiPrefix&&(console.error(new TypeError(`advancedMode.multiPrefix must be a boolean`)),process.exit(1)),s.advancedMode.serverPrefixs&&'object'!=typeof s.advancedMode.serverPrefixs&&(console.error(new TypeError(`advancedMode.serverPrefixs must be an object`)),process.exit(1)),'string'!=typeof s.thumbnailType&&(console.error(new TypeError(`thumbnailType must be a string`)),process.exit(1));s.thumbnailType.match(/default|medium|high/)||(console.error(new Error(`thumbnailType must be one of the following: default, medium, high`)),process.exit(1));'string'!=typeof s.helpHelp&&(console.error(new TypeError(`helpHelp must be a string`)),process.exit(1));'object'!=typeof s.helpAlt&&(console.error(new TypeError(`helpAlt must be an array`)),process.exit(1));'string'!=typeof s.playHelp&&(console.error(new TypeError(`playHelp must be a string`)),process.exit(1));'object'!=typeof s.playAlt&&(console.error(new TypeError(`playAlt must be an array`)),process.exit(1));'string'!=typeof s.queueHelp&&(console.error(new TypeError(`queueHelp must be a string`)),process.exit(1));'object'!=typeof s.queueAlt&&(console.error(new TypeError(`queueAlt must be an array`)),process.exit(1));'string'!=typeof s.pauseHelp&&(console.error(new TypeError(`pauseHelp must be a string`)),process.exit(1));'object'!=typeof s.pauseAlt&&(console.error(new TypeError(`pauseAlt must be an array`)),process.exit(1));'string'!=typeof s.resumeHelp&&(console.error(new TypeError(`resumeHelp must be a string`)),process.exit(1));'object'!=typeof s.resumeAlt&&(console.error(new TypeError(`resumeAlt must be an array`)),process.exit(1));'string'!=typeof s.volumeHelp&&(console.error(new TypeError(`volumeHelp must be a string`)),process.exit(1));'object'!=typeof s.volumeAlt&&(console.error(new TypeError(`volumeAlt must be an array`)),process.exit(1));'string'!=typeof s.leaveHelp&&(console.error(new TypeError(`leaveHelp must be a string`)),process.exit(1));'object'!=typeof s.leaveAlt&&(console.error(new TypeError(`leaveAlt must be an array`)),process.exit(1));'string'!=typeof s.clearHelp&&(console.error(new TypeError(`clearHelp must be a string`)),process.exit(1));'object'!=typeof s.clearAlt&&(console.error(new TypeError(`clearAlt must be an array`)),process.exit(1));'string'!=typeof s.loopHelp&&(console.error(new TypeError(`loopHelp must be a string`)),process.exit(1));'object'!=typeof s.loopAlt&&(console.error(new TypeError(`loopAlt must be an array`)),process.exit(1));'string'!=typeof s.npHelp&&(console.error(new TypeError(`npHelp must be a string`)),process.exit(1));'object'!=typeof s.npAlt&&(console.error(new TypeError(`npAlt must be an array`)),process.exit(1));'string'!=typeof s.ownerHelp&&(console.error(new TypeError(`ownerHelp must be a string`)),process.exit(1));'object'!=typeof s.ownerAlt&&(console.error(new TypeError(`ownerAlt must be an array`)),process.exit(1));'string'!=typeof s.skipHelp&&(console.error(new TypeError(`skipHelp must be a string`)),process.exit(1));'object'!=typeof s.skipAlt&&(console.error(new TypeError(`skipAlt must be an array`)),process.exit(1));s.youtubeKey||(console.error(new Error(`youtubeKey is required but missing`)),process.exit(1));s.youtubeKey&&'string'!=typeof s.youtubeKey&&(console.error(new TypeError(`youtubeKey must be a string`)),process.exit(1));'boolean'!=typeof s.disableHelp&&(console.error(new TypeError(`disableHelp must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disablePlay&&(console.error(new TypeError(`disablePlay must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableSkip&&(console.error(new TypeError(`disableSkip must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableQueue&&(console.error(new TypeError(`disableQueue must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disablePause&&(console.error(new TypeError(`disablePause must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableResume&&(console.error(new TypeError(`disableResume must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableLeave&&(console.error(new TypeError(`disableLeave must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableClear&&(console.error(new TypeError(`disableClear must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableLoop&&(console.error(new TypeError(`disableLoop must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableNp&&(console.error(new TypeError(`disableNp must be a boolean`)),process.exit(1)),'boolean'!=typeof s.disableOwnerCmd&&(console.error(new TypeError(`disableOwnerCmd must be a boolean`)),process.exit(1)),'string'!=typeof s.ownerCmd&&(console.error(new TypeError(`ownerCmd must be a string`)),process.exit(1)),'boolean'!=typeof s.ownerOverMember&&(console.error(new TypeError(`ownerOverMember must be a boolean`)),process.exit(1));s.ownerOverMember&&'string'!=typeof s.botOwner&&(console.error(new TypeError(`botOwner must be a string`)),process.exit(1));'string'!=typeof s.botPrefix&&(console.error(new TypeError(`prefix must be a string`)),process.exit(1));(1>s.botPrefix.length||10<s.botPrefix.length)&&(console.error(new RangeError(`prefix length must be between 1 and 10`)),process.exit(1));'boolean'!=typeof s.global&&(console.error(new TypeError(`global must be a boolean`)),process.exit(1));'number'!=typeof s.maxQueueSize&&(console.error(new TypeError(`maxQueueSize must be a number`)),process.exit(1));Number.isInteger(s.maxQueueSize)||(console.error(new TypeError(`maxQueueSize must be an integer`)),process.exit(1));'number'!=typeof s.defVolume&&(console.error(new TypeError(`defaultVolume must be a number`)),process.exit(1));(!Number.isInteger(s.defVolume)||1>s.defVolume||200<s.defVolume)&&(console.error(new TypeError(`defaultVolume must be an integer between 1 and 200`)),process.exit(1));'boolean'!=typeof s.anyoneCanSkip&&(console.error(new TypeError(`anyoneCanSkip must be a boolean`)),process.exit(1));'boolean'!=typeof s.clearInvoker&&(console.error(new TypeError(`clearInvoker must be a boolean`)),process.exit(1));'boolean'!=typeof s.enableAliveMessage&&(console.error(new TypeError(`enableAliveMessage must be a boolean`)),process.exit(1));'string'!=typeof s.aliveMessage&&(console.error(new TypeError(`aliveMessage must be a string`)),process.exit(1));'number'!=typeof s.aliveMessageTime&&(console.error(new TypeError(`aliveMessageTime must be a number`)),process.exit(1));'string'!=typeof s.helpCmd&&(console.error(new TypeError(`helpCmd must be a string`)),process.exit(1));'string'!=typeof s.playCmd&&(console.error(new TypeError(`playCmd must be a string`)),process.exit(1));'string'!=typeof s.searchCmd&&(console.error(new TypeError(`searchCmd must be a string`)),process.exit(1));'boolean'!=typeof s.disableSearch&&(console.error(new TypeError(`disableSearch must be a boolean`)),process.exit(1));'string'!=typeof s.skipCmd&&(console.error(new TypeError(`skipCmd must be a string`)),process.exit(1));'string'!=typeof s.queueCmd&&(console.error(new TypeError(`queueCmd must be a string`)),process.exit(1));'string'!=typeof s.pauseCmd&&(console.error(new TypeError(`pauseCmd must be a string`)),process.exit(1));'string'!=typeof s.npCmd&&(console.error(new TypeError(`npCmd must be a string`)),process.exit(1));'string'!=typeof s.resumeCmd&&(console.error(new TypeError(`resumeCmd must be a string`)),process.exit(1));'string'!=typeof s.volumeCmd&&(console.error(new TypeError(`volumeCmd must be a string`)),process.exit(1));'string'!=typeof s.leaveCmd&&(console.error(new TypeError(`leaveCmd must be a string`)),process.exit(1));'string'!=typeof s.clearCmd&&(console.error(new TypeError(`clearCmd must be a string`)),process.exit(1));'string'!=typeof s.loopCmd&&(console.error(new TypeError(`loopCmd must be a string`)),process.exit(1));'boolean'!=typeof s.enableQueueStat&&(console.error(new TypeError(`enableQueueStat must be a boolean`)),process.exit(1));'boolean'!=typeof s.anyoneCanAdjust&&(console.error(new TypeError(`anyoneCanAdjust must be a boolean`)),process.exit(1));'boolean'!=typeof s.logging&&(console.error(new TypeError(`logging must be a boolean`)),process.exit(1));'boolean'!=typeof s.requesterName&&(console.error(new TypeError(`requesterName must be a boolean`)),process.exit(1));'boolean'!=typeof s.inlineEmbeds&&(console.error(new TypeError(`inlineEmbeds must be a boolean`)),process.exit(1));'string'!=typeof s.joinCmd&&(console.error(new TypeError(`joinCmd must be a string`)),process.exit(1)),'boolean'!=typeof s.disableJoin&&(console.error(new TypeError(`disableJoin must be a boolean`)),process.exit(1)),'object'!=typeof s.joinAlt&&(console.error(new TypeError(`joinAlt must be an object (array)`)),process.exit(1)),'string'!=typeof s.joinHelp&&(console.error(new TypeError(`joinHelp must be a string`)),process.exit(1)),s.global&&50>s.maxQueueSize&&console.warn(`global queues are enabled while maxQueueSize is below 50! Recommended to use a higher size.`);try{if(!s.commands.has(s.helpCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.helpCmd} command.`);const t={name:s.helpCmd,usage:`${s.botPrefix}${s.helpCmd} [command]`,disabled:s.disableHelp,help:s.helpHelp,aliases:s.helpAlt,admin:!1,run:'musichelp'};s.commands.set(s.helpCmd,t),0<s.helpAlt.length&&s.helpAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.searchCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.searchCmd} command.`);const t={name:s.searchCmd,usage:`${s.botPrefix}${s.searchCmd} <query>`,disabled:s.disableSearch,help:s.searchHelp,aliases:s.searchAlt,admin:!1,run:'search'};s.commands.set(s.searchCmd,t),0<s.searchAlt.length&&s.searchAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.playCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.playCmd} command.`);const t={name:s.playCmd,usage:`${s.botPrefix}${s.playCmd} <song to queue>`,disabled:s.disablePlay,help:s.playHelp,aliases:s.playAlt,admin:!1,run:'play'};s.commands.set(s.playCmd,t),0<s.playAlt.length&&s.playAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.skipCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.skipCmd} command.`);const t={name:s.skipCmd,usage:`${s.botPrefix}${s.skipCmd} [numberOfSongs]`,disabled:s.disableSkip,help:s.skipHelp,aliases:s.skipAlt,admin:!0,run:'skip'};s.commands.set(s.skipCmd,t),0<s.skipAlt.length&&s.skipAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.queueCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.queueCmd} command.`);const t={name:s.queueCmd,usage:`${s.botPrefix}${s.queueCmd} [songNumber]`,disabled:s.disableQueue,help:s.queueHelp,aliases:s.queueAlt,admin:!1,run:'queue'};s.commands.set(s.queueCmd,t),0<s.queueAlt.length&&s.queueAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.pauseCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.pauseCmd} command.`);const t={name:s.pauseCmd,usage:null,disabled:s.disablePause,help:s.pauseHelp,aliases:s.pauseAlt,admin:!1,run:'pause'};s.commands.set(s.pauseCmd,t),0<s.pauseAlt.length&&s.pauseAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.resumeCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.resumeCmd} command.`);const t={name:s.resumeCmd,usage:null,disabled:s.disableResume,help:s.resumeHelp,aliases:s.resumeAlt,admin:!1,run:'resume'};s.commands.set(s.resumeCmd,t),0<s.resumeAlt.length&&s.resumeAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.volumeCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.volumeCmd} command.`);const t={name:s.volumeCmd,usage:`${s.botPrefix}${s.volumeCmd} <1 - 200>`,disabled:s.disableVolume,help:s.volumeHelp,aliases:s.volumeAlt,admin:!1,run:'volume'};s.commands.set(s.volumeCmd,t),0<s.volumeAlt.length&&s.volumeAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.clearCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.clearCmd} command.`);const t={name:s.clearCmd,usage:null,disabled:s.disableClear,help:s.clearHelp,aliases:s.clearAlt,admin:!1,run:'clearqueue'};s.commands.set(s.clearCmd,t),0<s.clearAlt.length&&s.clearAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.npCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.npCmd} command.`);const t={name:s.npCmd,usage:null,disabled:s.disableNp,help:s.npHelp,aliases:s.npAlt,admin:!1,run:'np'};s.commands.set(s.npCmd,t),0<s.npAlt.length&&s.npAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.leaveCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.leaveCmd} command.`);const t={name:s.leaveCmd,usage:null,disabled:s.disableLeave,help:s.leaveHelp,aliases:s.leaveAlt,admin:!1,run:'leave'};s.commands.set(s.leaveCmd,t),0<s.leaveAlt.length&&s.leaveAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.loopCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.loopCmd} command.`);const t={name:s.loopCmd,usage:null,disabled:s.disableLoop,help:s.loopHelp,aliases:s.loopAlt,admin:!1,run:'loop'};s.commands.set(s.loopCmd,t),0<s.loopAlt.length&&s.loopAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.setCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.setCmd} command.`);const t={name:s.setCmd,usage:`${s.botPrefix}${s.setCmd} <setting>`,disabled:s.disableSet,help:s.setHelp,aliases:s.setAlt,admin:!1,run:'set'};s.commands.set(s.setCmd,t),0<s.setAlt.length&&s.setAlt.forEach(o=>{s.aliases.set(o,t)})}if(!s.commands.has(s.joinCmd)){s.logging&&console.log(`[MUSIC] Mapping ${s.joinCmd} command.`);const t={name:s.joinCmd,usage:`${s.botPrefix}${s.joinCmd}`,disabled:s.disableJoin,help:s.joinHelp,aliases:s.joinAlt,admin:!1,run:'join'};s.commands.set(s.joinCmd,t),0<s.joinAlt.length&&s.setAlt.forEach(o=>{s.aliases.set(o,t)})}}catch(t){console.error(t.stack),process.exit(1)}})(),s.searcher=new YTSearcher({key:s.youtubeKey,revealkey:!0}),exports.changeKey=t=>{return new Promise((o,u)=>{t&&'string'==typeof t||u('invalid key provided'),s.youtubeKey=t,s.searcher=new YTSearcher({key:t,revealkey:!0}),o(s)})},n.on('message',t=>{const o=t.content.trim();if(s.advancedMode.enabled&&s.advancedMode.multiPrefix){if(s.botPrefixs.has(t.guild.id)){const u=s.botPrefixs.get(t.guild.id).prefix;if(!o.startsWith(u))return;const r=o.substring(u.toString().length).split(/[ \n]/)[0].trim(),c=o.substring(u.toString().length+r.length).trim(),f=o.slice(u.toString().length+r.length).trim().split(/ +/g);if(s.commands.has(r)){let h=s.commands.get(r);if(!h.disabled)return s[h.run](t,c,f)}else if(s.aliases.has(r)){let h=s.aliases.get(r);if(!h.disabled)return s[h.run](t,c,f)}}else if(o.startsWith(s.botPrefix)){const u=o.substring(s.botPrefix.length).split(/[ \n]/)[0].trim(),r=o.substring(s.botPrefix.length+u.length).trim(),c=o.slice(s.botPrefix.length+u.length).trim().split(/ +/g);if(s.commands.has(u)){let f=s.commands.get(u);if(!f.disabled)return s[f.run](t,r,c)}else if(s.aliases.has(u)){let f=s.aliases.get(u);if(!f.disabled)return s[f.run](t,r,c)}}}else if(o.startsWith(s.botPrefix)){const u=o.substring(s.botPrefix.length).split(/[ \n]/)[0].trim(),r=o.substring(s.botPrefix.length+u.length).trim(),c=o.slice(s.botPrefix.length+u.length).trim().split(/ +/g);if(s.commands.has(u)){let f=s.commands.get(u);if(!f.disabled)return s[f.run](t,r,c)}else if(s.aliases.has(u)){let f=s.aliases.get(u);if(!f.disabled)return s[f.run](t,r,c)}}}),n.on('ready',()=>{s.advancedMode&&!0===s.advancedMode.enabled&&s.advancedMode&&!0===s.advancedMode.multiPrefix&&'object'==typeof s.advancedMode.serverPrefixs&&n.guilds.forEach(t=>{if(s.advancedMode.serverPrefixs.has(t.id)){var o=s.advancedMode.serverPrefixs.get(t.id);let u={id:t.id,prefix:o.prefix};s.botPrefixs.set(t.id,u)}else{let u={id:t.id,prefix:s.botPrefix};s.botPrefixs.set(t.id,u)}});s.enableAliveMessage&&setInterval(function(){s.aliveMessage=3>s.aliveMessage.length?`----------------------------------\n${n.user.username} online since ${n.readyAt}!\n----------------------------------`:s.aliveMessage.replace(/{{username}}/g,`${n.user.username}`).replace(/{{starttime}}/g,`${n.readyAt}`),console.log(s.aliveMessage)},s.aliveMessageTime);console.log(`------- ${n.user.username} -------\n> Version: ${PACKAGE.version}\n> Extra Logging: ${s.logging}.\n> Using Global Queue: ${s.global}.\n> Node.js Version: ${process.version}\n------- ${n.user.username} -------`),s.enableQueueStat||console.log(`[MUSIC] enableQueueStat is 'false'. Queue will not have a Playing/Paused indicator.`),!0==s.checkQueues&&(console.warn(`[MUSIC] checkQueues is enabled.`),s.verify=t=>{return new Promise((o,u)=>{t?t&&null==t.songs?u(1):t&&t.songs.length>s.maxQueueSize&&0!==s.maxQueueSize?u(1):t&&0>t.songs.length?u(1):t&&'string'!=typeof t.loop?u(2):t&&!t.id&&u(3):u(0),t.songs.forEach(r=>{r.title&&r.url&&r.queuedOn&&r.requester||u(4)}),o('pass')})},exports.verifyQueue=s.verify,setInterval(()=>{s.queues.forEach(t=>{s.verify(t).then(()=>{s.logging&&console.log(`[Check Queues Music] Queue ${t.id} passed verification.`)}).catch(o=>{if(0<=o){let u={songs:[],last:null,loop:'none',id:`${t.toString()}`};s.queues.set(t.id,u)}try{const u=n.voiceConnections.find(r=>`${t.toString()}`==r.channel.guild.id);null!==u&&(u.player.dispatcher.end(),u.disconnect())}catch(u){console.error(u)}})})},3.6e6))}),s.updatePrefix=(t,o)=>{if(s&&s.advancedMode.enabled&&s.advancedMode.multiPrefix)return new Promise((u,r)=>{'string'!=typeof t&&r(`server was not a string`),'string'!=typeof o&&r(`prefix was not a string`);let c;if(s.botPrefixs.has(t))c=s.botPrefixs.get(t),c.prefix=o,s.botPrefixs.set(t,c),u(`Prefix updated to \`${o}\`!`);else{s.botPrefixs.set(t,{id:t,prefix:o}),u(`Prefix updated to \`${o}\`!`)}})},exports.updatePrefix=s.updatePrefix,s.isAdmin=t=>{return s.ownerOverMember&&t.id===s.botOwner||!!s.botAdmins.includes(t.id)||t.hasPermission('ADMINISTRATOR')},s.canSkip=(t,o)=>{return!!s.anyoneCanSkip||!!s.botAdmins.includes(t.id)||s.ownerOverMember&&t.id===s.botOwner||o[0].requester===t.id||!!s.isAdmin(t)},s.canAdjust=(t,o)=>{return!!s.anyoneCanAdjust||!!s.botAdmins.includes(t.id)||s.ownerOverMember&&t.id===s.botOwner||o[0].requester===t.id||!!s.isAdmin(t)},s.dInvoker=t=>{if(s.clearInvoker){if(!t)return;t.delete()}},s.getQueue=(t,o)=>{if(s.global&&(t='_'),!s.queues.has(t)){let u={songs:[],last:null,loop:'none',id:t};s.queues.set(t,u)}return!0==o?s.queues.get(t).songs:o&&!1!=o?void 0:s.queues.get(t)},s.setLast=(t,o)=>{return new Promise((u,r)=>{let c;s.queues.has(t)?(c=s.queues.get(t),c.last=o,s.queues.set(t,c),u(s.queues.get(t))):r('no server queue')})},s.getLast=t=>{return new Promise(o=>{let r=s.queues.has(t)?s.queues.get(t).last:null;r&&r.last?r.last&&o(r.last):o(null)})},s.isQueueEmpty=t=>{return new Promise((o,u)=>{t||u('no queue passed');'object'==typeof t?0<t.length?o(!1):0>=t.length&&o(!0):t&&t.songs?0<t.songs.length?o(!1):0>=t.songs.length&&o(!0):u('no queue/songs found')})},exports.isQueueEmpty=s.isQueueEmpty,s.emptyQueue=t=>{return new Promise((o,u)=>{let r=s.queues.has(t)?s.queues.get(t):null;r||u(new Error(`[emptyQueue] no queue found for ${t}`));s.queues.set(t,{songs:[],last:null,loop:'none',id:t}),o(s.queues.get(t))})},s.musichelp=(t,o)=>{s.dInvoker(t);let u=o.trim();if(!o){if(t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){const h=new Discord.RichEmbed;h.setAuthor('Commands',t.author.displayAvatarURL),h.setDescription(`Use \`${s.botPrefix}${s.helpCmd} command name\` for help on usage.`);const g=Array.from(s.commands);for(var r=0;r<g.length;r++){let p=g[r][1];p.disabled||h.addField(p.name,p.help)}h.setColor(s.embedColor),setTimeout(()=>{if(s.messageHelp){let p=!1;t.author.send({embed:h}).then(()=>{p=!0}),setTimeout(()=>{if(!p)return t.channel.send({embed:h})},1200)}else return t.channel.send({embed:h})},1500)}else{var c=`= Music Commands =\nUse ${s.botPrefix}${s.helpCmd} [command] for help on a command.\n`;const h=Array.from(s.commands);for(var r=0;r<h.length;r++){let g=h[r][1];g.disabled||(c+=`\n• ${g.name}: ${g.help}`)}setTimeout(()=>{if(s.messageHelp){let g=!1;t.author.send(c,{code:'asciidoc'}).then(()=>{g=!0}),setTimeout(()=>{if(!g)return t.channel.send(c,{code:'asciidoc'})},500)}else return t.channel.send(c,{code:'asciidoc'})},1500)}}else if(!(s.commands.has(u)||s.aliases.has(u)))t.channel.send(s.note('fail',`${o} is not a valid command!`));else if(t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){const h=new Discord.RichEmbed;u=s.commands.get(u)||s.aliases.get(u),h.setAuthor(u.name,t.client.user.avatarURL),h.setDescription(u.help),0<u.aliases.length&&h.addField(`Aliases`,u.aliases.join(', '),s.inlineEmbeds),null!==u.usage&&h.addField(`Usage`,u.usage,s.inlineEmbeds),h.setColor(s.embedColor),t.channel.send({embed:h})}else{u=s.commands.get(u)||s.aliases.get(u);var f=`= ${u.name} =\n`;f+`\n${u.help}`,null!==u.usage&&(f+=`\nUsage: ${u.usage}\n`),0<u.aliases.length&&(f+=`\nAliases: ${u.aliases.join(', ')}`),t.channel.send(f,{code:'asciidoc'})}},s.play=(t,o)=>{if(s.dInvoker(t),void 0===t.member.voiceChannel)return t.channel.send(s.note('fail',`You're not in a voice channel.`));if(!o)return t.channel.send(s.note('fail','No video specified!'));const u=s.getQueue(t.guild.id);if(u.songs.length>=s.maxQueueSize&&0!==s.maxQueueSize)return t.channel.send(s.note('fail','Maximum queue size reached!'));var r=o.trim();t.channel.send(s.note('search',`Searching: \`${r}\``)).then(c=>{if(r.startsWith('http')&&r.includes('list=')){var f=r.toString().split('list=')[1];f.toString().includes('?')&&(f=f.split('?')[0]),f.toString().includes('&t=')&&(f=f.split('&t=')[0]),ypi.playlistInfo(s.youtubeKey,f,function(h){const g=Array.from(h);var p=0,b=0;g.forEach(v=>{(b++,u.songs.length!=s.maxQueueSize+1||0===s.maxQueueSize)&&('youtube#video'==v.resourceId.kind&&(!v.url&&(v.url=`https://www.youtube.com/watch?v=`+v.resourceId.videoId),v.requester=t.author.id,v.queuedOn=new Date().toLocaleDateString(s.dateLocal,{weekday:'long',hour:'numeric'}),s.requesterName&&(v.requesterAvatarURL=t.author.displayAvatarURL),u.songs.push(v),1===u.songs.length&&s.executeQueue(t,u),p++),b==g.length&&((p=0)?t.channel.send(s.note('fail',`Coudln't get any songs from that playlist.`)):1==p?t.channel.send(s.note('note',`Queued one song.`)):1<p&&t.channel.send(s.note('note',`Queued ${p} songs.`))))})})}else s.searcher.search(r,{type:'video'}).then(h=>{if(!h.totalResults||0===h.totalResults)return c.edit(s.note('fail','Failed to get search results.'));var g=h.first;if(g.requester=t.author.id,g.channelURL=`https://www.youtube.com/channel/${g.channelId}`,g.queuedOn=new Date().toLocaleDateString(s.dateLocal,{weekday:'long',hour:'numeric'}),s.requesterName&&(g.requesterAvatarURL=t.author.displayAvatarURL),u.songs.push(g),1<u.songs.length)if(t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){const b=new Discord.RichEmbed;try{b.setAuthor('Adding To Queue',n.user.avatarURL);var p=g.title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');b.setColor(s.embedColor),b.addField(g.channelTitle,`[${p}](${g.url})`,s.inlineEmbeds),b.addField('Queued On',g.queuedOn,s.inlineEmbeds),b.setThumbnail(g.thumbnails.high.url);const v=n.users.get(g.requester);s.requesterName&&v&&b.setFooter(`Requested by ${n.users.get(g.requester).username}`,g.requesterAvatarURL),s.requesterName&&!v&&b.setFooter(`Requested by \`UnknownUser (ID: ${g.requester})\``,g.requesterAvatarURL),t.channel.send({embed:b})}catch(v){console.error(`[${t.guild.name}] [npCmd] `+v.stack)}}else try{var p=g.title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');t.channel.send(`Now Playing: **${p}**\nRequested By: ${n.users.get(g.requester).username}\nQueued On: ${g.queuedOn}`)}catch(b){console.error(`[${t.guild.name}] [npCmd] `+b.stack)}1!==u.songs.length&&n.voiceConnections.find(b=>b.channel.guild.id==t.guild.id)||s.executeQueue(t,u)})}).catch(console.log)},s.search=(t,o)=>{if(s.dInvoker(t),void 0===t.member.voiceChannel)return t.channel.send(s.note('fail',`You're not in a voice channel~`));if(!o)return t.channel.send(s.note('fail','No video specified!'));const u=s.getQueue(t.guild.id);if(u.songs.length>=s.maxQueueSize&&0!==s.maxQueueSize)return t.channel.send(s.note('fail','Maximum queue size reached!'));var r=o.trim();t.channel.send(s.note('search',`Searching: \`${r}\``)).then(c=>{s.searcher.search(r,{type:'video'}).then(f=>{if(!f.totalResults||0===f.totalResults)return c.edit(s.note('fail','Failed to get search results.'));const h=async(C,x)=>{const y=new Discord.RichEmbed;y.setTitle(`Choose Your Video`),y.setColor(s.embedColor);var A=0;C.forEach(function(k){A++,y.addField(`${A} (${k.channelTitle})`,`[${s.note('font',k.title)}](${k.url})`,s.inlineEmbeds)}),y.setFooter(`Search by: ${t.author.username}`,t.author.displayAvatarURL),t.channel.send({embed:y}).then(k=>{var P=null;0===x?P=S=>S.author.id===t.author.id&&S.content.includes('1')||`cancel`===S.content.trim():1===x?P=S=>S.author.id===t.author.id&&S.content.includes('1')||S.content.includes('2')||`cancel`===S.content.trim():2===x?P=S=>S.author.id===t.author.id&&S.content.includes('1')||S.content.includes('2')||S.content.includes('3')||`cancel`===S.content.trim():3===x?P=S=>S.author.id===t.author.id&&S.content.includes('1')||S.content.includes('2')||S.content.includes('3')||S.content.includes('4')||`cancel`===S.content.trim():4===x?P=S=>S.author.id===t.author.id&&S.content.includes('1')||S.content.includes('2')||S.content.includes('3')||S.content.includes('4')||S.content.includes('5')||`cancel`===S.content.trim():5===x?P=S=>S.author.id===t.author.id&&S.content.includes('1')||S.content.includes('2')||S.content.includes('3')||S.content.includes('4')||S.content.includes('5')||S.content.includes('6')||`cancel`===S.content.trim():6===x?P=S=>S.author.id===t.author.id&&S.content.includes('1')||S.content.includes('2')||S.content.includes('3')||S.content.includes('4')||S.content.includes('5')||S.content.includes('6')||S.content.includes('7')||`cancel`===S.content.trim():7===x?P=S=>S.author.id===t.author.id&&S.content.includes('1')||S.content.includes('2')||S.content.includes('3')||S.content.includes('4')||S.content.includes('5')||S.content.includes('6')||S.content.includes('7')||S.content.includes('8')||`cancel`===S.content.trim():8===x?P=S=>S.author.id===t.author.id&&S.content.includes('1')||S.content.includes('2')||S.content.includes('3')||S.content.includes('4')||S.content.includes('5')||S.content.includes('6')||S.content.includes('7')||S.content.includes('8')||S.content.includes('9')||`cancel`===S.content.trim():9==x&&(P=S=>S.author.id===t.author.id&&S.content.includes('1')||S.content.includes('2')||S.content.includes('3')||S.content.includes('4')||S.content.includes('5')||S.content.includes('6')||S.content.includes('7')||S.content.includes('8')||S.content.includes('9')||S.content.includes('10')||`cancel`===S.content.trim()),t.channel.awaitMessages(P,{max:1,time:6e4,errors:['time']}).then(S=>{const Q=Array.from(S),E=Q[0][1].content;if('cancel'===E)return k.edit(s.note('note','Searching canceled.'));const L=parseInt(E)-1;if(0<=L)return k.delete(),t.channel.send(s.note('note',`Queued **${s.note('font',C[L].title)}**`)).then(()=>{u.songs.push(C[L]),1!==u.songs.length&&n.voiceConnections.find(j=>j.channel.guild.id==t.guild.id)||s.executeQueue(t,u)}).catch(console.log)}).catch(S=>{return S.toString().match(/error|Error|TypeError|RangeError|Uncaught/)?k.edit(`\`\`\`xl\nSearching canceled. ${S}\n\`\`\``):k.edit(`\`\`\`xl\nSearching canceled.\n\`\`\``)})})},g=10<=f.totalResults?9:f.totalResults-1;for(var v,p=[],b=0;99>b;b++)v=f.currentPage[b],v.requester=t.author.id,s.requesterName&&(v.requesterAvatarURL=t.author.displayAvatarURL),v.channelURL=`https://www.youtube.com/channel/${v.channelId}`,v.queuedOn=new Date().toLocaleDateString(s.dateLocal,{weekday:'long',hour:'numeric'}),p.push(v),b===g&&(b=101,h(p,g))})}).catch(console.log)},s.skip=(t,o)=>{s.dInvoker(t);const u=n.voiceConnections.find(h=>h.channel.guild.id==t.guild.id);if(null===u)return t.channel.send(s.note('fail','No music being played.'));const r=s.getQueue(t.guild.id);if(!s.canSkip(t.member,r.songs))return t.channel.send(s.note('fail',`You cannot skip this as you didn't queue it.`)).then(h=>{h.delete(5e3)});let c=s.queues.get(t.guild.id);'none'!==c.loop&&('none'==c.loop,s.queues.set(t.guild.server,c));let f=1;!isNaN(o)&&0<parseInt(o)&&(f=parseInt(o)),f=Math.min(f,r.songs.length),r.songs.splice(0,f-1);try{const h=u.player.dispatcher;if((!h||null===h)&&s.logging)return console.log(new Error(`dispatcher null on skip cmd [${t.guild.name}] [${t.author.username}]`));u.paused&&h.resume(),h.end()}catch(h){s.logging&&console.log(new Error(`Skip command dispatcher error from userID ${t.author.id} in guildID ${t.guild.id}\n${h.stack}`));const g=h.toString().split(':');return t.channel.send(s.note('fail',`Error occoured!\n\`\`\`\n${g[0]}: ${g[1]}\n\`\`\``))}return s.queues.has(t.guild.id)&&'none'!==s.queues.get(t.guild.id).loop?t.channel.send(s.note('note','Skipped **'+f+'**! (Disabled Looping)')):t.channel.send(s.note('note','Skipped **'+f+'**!'))},s.queue=(t,o)=>{s.dInvoker(t);const u=s.getQueue(t.guild.id,!0);s.isQueueEmpty(s.queues.get(t.guild.id)).then(f=>{if(!0==f)return t.channel.send(s.note('note','Queue empty.'))}).catch(f=>{if(f)return console.log(`[isQueueEmpty] [queueCmd] [${t.guild.name}]: ${new Error(f)}`),t.channel.send(s.note('fail','Error occoured!'))});let r;if(t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){const f=o?parseInt(o)-1:null;let h=u.length;if(!o){const g=new Discord.RichEmbed;if(25<u.length&&(h=25),s.enableQueueStat){let p='Stopped';const b=n.voiceConnections.find(v=>v.channel.guild.id==t.guild.id);if(null!==b){const v=b.player.dispatcher;p=v.paused?'Paused':'Playing',g.setAuthor(`Song Queue (${p})`,n.user.avatarURL)}else g.setAuthor(`Song Queue`,n.user.avatarURL)}try{for(var c=0;c<h;c++)u[c]!==u.last&&u[c]!==u.loop&&g.addField(`${u[c].channelTitle}`,`[${u[c].title}](${u[c].url})`,s.inlineEmbeds);g.setColor(s.embedColor),g.setFooter(`Total songs: ${u.length}`,t.author.displayAvatarURL)}catch(p){console.log(p.stack)}setTimeout(()=>{t.channel.send({embed:g})},1500)}else if(t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){if(f>u.length)return t.channel.send(s.note('fail','Not a valid song number.'));const g=new Discord.RichEmbed,p=n.users.get(u[f].requester);g.setAuthor(`Queued Song #${o}`,n.user.avatarURL),g.addField(u[f].channelTitle,`[${u[f].title}](${u[f].url})`,s.inlineEmbeds),g.addField(`Queued On`,u[f].queuedOn,s.inlineEmbeds),g.setThumbnail(u[f].thumbnails[s.thumbnailType].url),g.setColor(s.embedColor),s.requesterName&&p&&g.setFooter(`Queued by: ${p.username}`,u[f].requesterAvatarURL),s.requesterName&&!p&&g.setFooter(`Queued by: \`UnknownUser (id: ${u[f].requester})\``,u[f].requesterAvatarURL),t.channel.send({embed:g})}else;}else try{r=s.requesterName?u.map((f,h)=>h+1+': '+f.title+' | Requested by '+n.users.get(f.requester).username).join('\n'):u.map((f,h)=>h+1+': '+f.title).join('\n')}catch(f){s.logging&&console.log(`[${t.guild.name}] [queueCmd] `+f.stack);const h=f.toString().split(':');return t.channel.send(s.note('fail',`Error occoured!\n\`\`\`\n${h[0]}: ${h[1]}\n\`\`\``))}finally{if(1900<r.length){const f=r.substr(0,1899),h=r.substr(1900,r.length);if(1900<h.length){let g='Stopped';const p=n.voiceConnections.find(b=>b.channel.guild.id==t.guild.id);if(null!==p){const b=p.player.dispatcher;g=b.paused?'Paused':'Playing'}t.channel.send(s.note('wrap','Queue ('+g+'):\nPast character limit...'))}else if(s.enableQueueStat){let g='Stopped';const p=n.voiceConnections.find(b=>b.channel.guild.id==t.guild.id);if(null!==p){const b=p.player.dispatcher;g=b.paused?'Paused':'Playing'}t.channel.send(s.note('wrap','Queue ('+g+'):\n'+f)),t.channel.send(s.note('wrap','Queue (2) ('+g+'):\n'+h))}else t.channel.send(s.note('wrap','Queue:\n'+f)),t.channel.send(s.note('wrap','Queue (2):\n'+h))}else if(s.enableQueueStat){let f='Stopped';const h=n.voiceConnections.find(g=>g.channel.guild.id==t.guild.id);if(null!==h){const g=h.player.dispatcher;f=g.paused?'Paused':'Playing'}t.channel.send(s.note('wrap','Queue ('+f+'):\n'+r))}else t.channel.send(s.note('wrap','Queue:\n'+r))}},s.np=t=>{s.dInvoker(t);const u=n.voiceConnections.find(h=>h.channel.guild.id==t.guild.id),r=s.getQueue(t.guild.id,!0);if(null===u&&0<r.length)return t.channel.send(s.note('fail','No music is being played, but an ongoing queue is avainable.'));if(null===u)return t.channel.send(s.note('fail','No music is being played.'));u.player.dispatcher;if(s.isQueueEmpty(s.queues.get(t.guild.id)).then(h=>{if(!0==h)return t.channel.send(s.note('note','Queue empty.'))}).catch(h=>{if(h)return console.log(`[isQueueEmpty] [np] [${t.guild.name}]: ${new Error(h)}`),t.channel.send(s.note('fail','Error occoured!'))}),t.channel.permissionsFor(t.guild.me).has('EMBED_LINKS')){const h=new Discord.RichEmbed;try{h.setAuthor('Now Playing',n.user.avatarURL);var f=r[0].title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');h.setColor(s.embedColor),h.addField(r[0].channelTitle,`[${f}](${r[0].url})`,s.inlineEmbeds),h.addField('Queued On',r[0].queuedOn,s.inlineEmbeds),h.setThumbnail(r[0].thumbnails.high.url);const g=n.users.get(r[0].requester);s.requesterName&&g&&h.setFooter(`Requested by ${n.users.get(r[0].requester).username}`,r[0].requesterAvatarURL),s.requesterName&&!g&&h.setFooter(`Requested by \`UnknownUser (ID: ${r[0].requester})\``,r[0].requesterAvatarURL),t.channel.send({embed:h})}catch(g){console.error(`[${t.guild.name}] [npCmd] `+g.stack)}}else try{var f=r[0].title.replace(/\\/g,'\\\\').replace(/\`/g,'\\`').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`');t.channel.send(`Now Playing: **${f}**\nRequested By: ${n.users.get(r[0].requester).username}\nQueued On: ${r[0].queuedOn}`)}catch(h){console.error(`[${t.guild.name}] [npCmd] `+h.stack)}},s.pause=t=>{s.dInvoker(t);const u=n.voiceConnections.find(c=>c.channel.guild.id==t.guild.id);if(null===u)return t.channel.send(s.note('fail','No music being played.'));if(!s.isAdmin(t.member)&&!s.anyoneCanPause)return t.channel.send(s.note('fail','Only Admins are allowed to use this command.'));const r=u.player.dispatcher;return r.paused?t.channel.send(s.note(`fail`,`Music already paused!`)):void(t.channel.send(s.note('note','Playback paused.')),!r.paused&&r.pause())},s.leave=t=>{if(s.dInvoker(t),s.isAdmin(t.member)||!0===s.anyoneCanLeave){const u=n.voiceConnections.find(r=>r.channel.guild.id==t.guild.id);if(null===u)return t.channel.send(s.note('fail','I\'m not in a voice channel.'));if(s.clearOnLeave&&s.emptyQueue(t.guild.id),!u.player.dispatcher)return;u.player.dispatcher.end(),u.disconnect(),t.channel.send(s.note('note','Successfully left your voice channel!')),setTimeout(()=>{let r=n.voiceConnections.find(c=>c.channel.guild.id==t.guild.id);if(r.player.dispatcher)try{r.player.dispatcher.end(),r.disconnect()}catch(c){console.error(`[leaevCmd] [${t.guild.name}] ${c.stack}`)}},2500)}else{const u=Math.floor(100*Math.random()+1);return 10>=u?t.channel.send(s.note('fail',`I'm afraid I can't let you do that, ${t.author.username}.`)):t.channel.send(s.note('fail','Sorry, you\'re not allowed to do that.'))}},s.join=t=>{if(s.dInvoker(t),!(s.isAdmin(t.member)||!0===s.anyoneCanJoin)){const u=Math.floor(100*Math.random()+1);return 10>=u?t.channel.send(s.note('fail',`I'm afraid I can't let you do that, ${t.author.username}.`)):t.channel.send(s.note('fail','Sorry, you\'re not allowed to do that.'))}if(t.member.voiceChannel&&t.member.voiceChannel.joinable)t.member.voiceChannel.join().then(()=>{t.channel.send(s.note('note','Joined your voice channel. :ok_hand:'))}).catch(u=>{console.error(u),t.channel.send(s.note('fail','Error occoured!'))});else{if(!t.member.voiceChannel)return t.channel.send(s.note('fail','Doesn\'t seem you\'re in a voice channel.'));if(t.member.voiceChannel&&!t.member.voiceChannel.joinable)return t.channel.send(s.note('fail','Can\'t join your voice channel.'))}},s.clearqueue=t=>{return s.dInvoker(t),s.queues.has(t.guild.id)?void(s.isAdmin(t.member)?s.emptyQueue(t.guild.id).then(()=>{const u=n.voiceConnections.find(r=>r.channel.guild.id==t.guild.id);null!==u&&(u.player.dispatcher.end(),u.disconnect()),t.channel.send(s.note('note','Queue cleared.'))}).catch(u=>{console.log(new Error(`[clearQueue] [${t.guild.name}] ${u}`))}):t.channel.send(s.note('fail',`I'm sorry, but you cannot do this.`))):t.channel.send(s.note('fail','No server queue.'))},s.resume=t=>{s.dInvoker(t);const u=n.voiceConnections.find(c=>c.channel.guild.id==t.guild.id);if(null===u)return t.channel.send(s.note('fail','No music is being played.'));if(!s.isAdmin(t.member)&&!s.anyoneCanPause)return t.channel.send(s.note('fail',`I'm sorry, but you cannot do this.`));t.channel.send(s.note('note','Playback resumed.'));const r=u.player.dispatcher;r.paused&&r.resume()},s.volume=(t,o)=>{s.dInvoker(t);const u=n.voiceConnections.find(f=>f.channel.guild.id==t.guild.id);if(null===u)return t.channel.send(s.note('fail','No music is being played.'));if(!o)return t.channel.send(s.note('fail','No volume specified.'));o=parseInt(o);const r=s.getQueue(t.guild.id,!0);if(!s.canAdjust(t.member,r))return t.channel.send(s.note('fail',`I'm sorry, but you cannot do that.`));const c=u.player.dispatcher;return 200<o||0>=o?t.channel.send(s.note('fail','Volume out of range, must be within 1 - 200')):void(c.setVolume(o/100),t.channel.send(s.note('note','Volume set to '+o)))},s.loop=t=>{if(s.dInvoker(t),!s.queues.has(t.guild.id))return t.channel.send(s.note('fail',`No queue for this server found!`));var u=s.queues.get(t.guild.id);return'none'!=u.loop&&u.loop?'single'==u.loop?(u.loop='queue',s.queues.set(t.guild.id,u),t.channel.send(s.note('note','Looping queue enabled! :repeat:'))):'queue'==u.loop?('none'==u.loop,s.queues.set(t.guild.id,u),t.channel.send(s.note('note','Looping disabled! :arrow_forward:'))):void 0:(u.loop='single',s.queues.set(t.guild.id,u),t.channel.send(s.note('note','Looping single enabled! :repeat_one:')))},s.set=(t,o,u)=>{if(!s.isAdmin(t.member))return t.channel.send(s.note('fail',`Only admins may do this!`));const r=['prefix'];if(!u[0])return t.channel.send(s.note('note',`Valid settings are: ${r.join(', ')}.`));if(!r.includes(u[0]))return t.channel.send(s.note('fail','Not a valid setting!'));if(u[0]&&'prefix'==u[0]){const c=u.slice(1,u.length).join(' ');if(!c||1>c.legnth)return t.channel.send(s.note('fail','Please specify a prefix!'));s.updatePrefix(t.guild.id,c).then(f=>{f&&t.channel.send(s.note('note',f))}).catch(f=>{if(f)return t.channel.send(s.note('fail',`Error!\n${f}`)),console.log(`[updatePrefix] [${t.guild.id}] ${f}`)})}},s.executeQueue=(t,o)=>{if(0>=o.songs.length){const u=n.voiceConnections.find(r=>r.channel.guild.id==t.guild.id);if(null===u)return}s.isQueueEmpty(o).then(u=>{if(!0==u){t.channel.send(s.note('note','Playback finished.'));const r=n.voiceConnections.find(c=>c.channel.guild.id==t.guild.id);if(null!==r)return r.disconnect()}}).catch(u=>{if(u){console.error(`[executeQueue]: ${new Error(u)}`),t.channel.send(s.note('fail','Error occoured on starting the queue!'));const r=n.voiceConnections.find(c=>c.channel.guild.id==t.guild.id);if(null!==r)return r.disconnect()}}),new Promise((u,r)=>{const c=n.voiceConnections.find(f=>f.channel.guild.id==t.guild.id);null===c?t.member.voiceChannel&&t.member.voiceChannel.joinable?t.member.voiceChannel.join().then(f=>{u(f)}).catch(f=>{console.log(f)}):t.member.voiceChannel.joinable?s.emptyQueue(t.guild.id).then(()=>{r()}):(t.channel.send(s.note('fail','I do not have permission to join your voice channel!')),r()):u(c)}).then(u=>{const r=o.songs[0];try{s.getLast(t.guild.id).then(f=>{s.setLast(t.guild.id,r).then(()=>{const p=s.queues.get(t.guild.id);f!==r&&'none'==p.loop&&s.np(t)}).catch(g=>{return t.channel.send(s.note('fail','Error occoured, try again!')),console.error(new Error('Dispatcher SetLast: '+g))})}).catch(f=>{if(f)return t.channel.send(s.note('fail','Error occoured, try again!')),console.error(new Error('Dispatcher GetLast: '+f))});let c=u.playStream(ytdl(r.url,{filter:'audioonly'}),{volume:s.defVolume/100});u.on('error',f=>{console.log(`Dispatcher/connection: ${f}`),t&&t.channel&&t.channel.send(s.note('fail',`Dispatcher error!\n\`${f}\``)),o.songs.shift(),s.executeQueue(t,o)}),c.on('error',f=>{console.log(`Dispatcher: ${f.stack}`),t&&t.channel&&t.channel.send(s.note('fail',`Dispatcher error!\n\`${f}\``)),o.songs.shift(),s.executeQueue(t,o)}),c.on('end',()=>{setTimeout(()=>{let f=s.getQueue(t.guild.id);if('single'==f.loop)s.executeQueue(t,o);else if('queue'==f.loop)o.songs.push(o.songs[0]),o.songs.shift(),s.executeQueue(t,o);else if(0<o.songs.length)o.songs.shift(),s.executeQueue(t,o);else if(0>=o.songs.length){t&&t.channel&&t.channel.send(s.note('note','Playback finished.'));const h=n.voiceConnections.find(g=>g.channel.guild.id==t.guild.id);if(null!==h)return h.disconnect()}},1e3)})}catch(c){console.log(c)}}).catch(u=>{console.log(u)})},s.note=(t,o)=>{if('wrap'===t){let u=o.replace(/`/g,'`'+String.fromCharCode(8203)).replace(/@/g,'@'+String.fromCharCode(8203)).replace(n.token,'REMOVED');return'```\n'+u+'\n```'}return'note'===t?':musical_note: | '+o.replace(/`/g,'`'+String.fromCharCode(8203)):'search'===t?':mag: | '+o.replace(/`/g,'`'+String.fromCharCode(8203)):'fail'===t?':no_entry_sign: | '+o.replace(/`/g,'`'+String.fromCharCode(8203)):'font'===t?o.replace(/`/g,'`'+String.fromCharCode(8203)).replace(/@/g,'@'+String.fromCharCode(8203)).replace(/\\/g,'\\\\').replace(/\*/g,'\\*').replace(/_/g,'\\_').replace(/~/g,'\\~').replace(/`/g,'\\`'):void console.error(new Error(`${t} was an invalid type`))},exports.note=s.note,exports.addAdmin=t=>{return new Promise((o,u)=>{t&&'string'==typeof t||u('invalid admin object'),s.botAdmins.push(t),o(s.botAdmins)})},exports.getQueue=t=>{if(!t)return console.error(new Error('no server provided for getQueue')),null;let o=s.queues.has(t)?s.queues.get(t):null;return o},exports.setQueue=t=>{return new Promise((o,u)=>{t||u(new Error('no data passed to setQueue')),'string'==typeof t?(t={songs:[],last:null,loop:'none',id:t},s.queues.set(t.id,t),o(s.queues.get(t.id))):'object'==typeof t?((!t.songs||'object'!=typeof t.songs)&&(t.songs=[]),!t.last&&(t.last=null),(!t.loop||'string'!=typeof t.loop)&&(t.loop='none'),(!t.id||'string'!=typeof t.id)&&(t.id=t.toString()),s.queues.set(t.id,t),o(s.queues.get(t.id))):u(new Error('data didn\'t equal a string or object'))})}};
